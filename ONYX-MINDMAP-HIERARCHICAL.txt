ONYX ENTERPRISE AI SEARCH - COMPLETE ARCHITECTURE
================================================

ğŸ” AUTH & ACCESS
â”œâ”€â”€ Authentication
â”‚   â”œâ”€â”€ JWT Tokens
â”‚   â”‚   â”œâ”€â”€ generate_jwt_token (backend/onyx/auth/jwt.py)
â”‚   â”‚   â””â”€â”€ verify_jwt_token (backend/onyx/auth/jwt.py)
â”‚   â”œâ”€â”€ OAuth2
â”‚   â”‚   â”œâ”€â”€ oauth_authorization_url (backend/onyx/server/documents/standard_oauth.py)
â”‚   â”‚   â”œâ”€â”€ oauth_code_to_token (backend/onyx/server/documents/standard_oauth.py)
â”‚   â”‚   â””â”€â”€ OAuthConnector interface (backend/onyx/connectors/interfaces.py)
â”‚   â”œâ”€â”€ SAML SSO [EE]
â”‚   â”‚   â”œâ”€â”€ saml_auth_flow (ee/onyx/auth/saml.py)
â”‚   â”‚   â””â”€â”€ saml_metadata_handler (ee/onyx/auth/saml.py)
â”‚   â”œâ”€â”€ API Keys
â”‚   â”‚   â”œâ”€â”€ create_api_key (backend/onyx/db/api_key.py)
â”‚   â”‚   â””â”€â”€ validate_api_key (backend/onyx/auth/api_key.py)
â”‚   â””â”€â”€ FastAPI-Users
â”‚       â”œâ”€â”€ UserManager (backend/onyx/auth/users.py)
â”‚       â”œâ”€â”€ get_user_db (backend/onyx/db/engine.py)
â”‚       â””â”€â”€ current_user dependency (backend/onyx/auth/users.py)
â””â”€â”€ Authorization
    â”œâ”€â”€ Access Control
    â”‚   â”œâ”€â”€ _get_access_for_documents (backend/onyx/db/document.py)
    â”‚   â”œâ”€â”€ _get_acl_for_user (backend/onyx/db/document.py)
    â”‚   â””â”€â”€ check_user_access (backend/onyx/access/access.py)
    â”œâ”€â”€ User Roles
    â”‚   â”œâ”€â”€ ADMIN
    â”‚   â”œâ”€â”€ CURATOR
    â”‚   â”œâ”€â”€ BASIC
    â”‚   â””â”€â”€ GLOBAL_CURATOR
    â”œâ”€â”€ Document Permissions
    â”‚   â”œâ”€â”€ DocumentAccess model (backend/onyx/db/models.py)
    â”‚   â”œâ”€â”€ ExternalAccess model (ee/onyx/db/models.py)
    â”‚   â””â”€â”€ ACL filtering (backend/onyx/document_index/vespa/index.py)
    â”œâ”€â”€ User Groups [EE]
    â”‚   â”œâ”€â”€ UserGroup model (ee/onyx/db/models.py)
    â”‚   â”œâ”€â”€ User__UserGroup mapping (ee/onyx/db/models.py)
    â”‚   â”œâ”€â”€ Group-based access (ee/onyx/access/access.py)
    â”‚   â””â”€â”€ Curator privileges (ee/onyx/access/access.py)
    â””â”€â”€ External Permissions [EE]
        â”œâ”€â”€ Permission Sync
        â”‚   â”œâ”€â”€ confluence_doc_sync (ee/onyx/connectors/confluence/permissions.py)
        â”‚   â”œâ”€â”€ gdrive_doc_sync (ee/onyx/connectors/google_drive/permissions.py)
        â”‚   â””â”€â”€ jira_doc_sync (ee/onyx/connectors/jira/permissions.py)
        â””â”€â”€ Salesforce Censoring
            â””â”€â”€ censor_salesforce_chunks (ee/onyx/connectors/salesforce/censoring.py)

ğŸ”Œ CONNECTORS (50+)
â”œâ”€â”€ Framework
â”‚   â”œâ”€â”€ Base Interfaces
â”‚   â”‚   â”œâ”€â”€ BaseConnector (backend/onyx/connectors/interfaces.py)
â”‚   â”‚   â”œâ”€â”€ LoadConnector (backend/onyx/connectors/interfaces.py)
â”‚   â”‚   â”œâ”€â”€ PollConnector (backend/onyx/connectors/interfaces.py)
â”‚   â”‚   â”œâ”€â”€ CheckpointedConnector (backend/onyx/connectors/interfaces.py)
â”‚   â”‚   â”œâ”€â”€ OAuthConnector (backend/onyx/connectors/interfaces.py)
â”‚   â”‚   â””â”€â”€ SlimConnector (backend/onyx/connectors/interfaces.py)
â”‚   â””â”€â”€ Factory & Registry
â”‚       â”œâ”€â”€ identify_connector_class (backend/onyx/connectors/factory.py)
â”‚       â”œâ”€â”€ instantiate_connector (backend/onyx/connectors/factory.py)
â”‚       â””â”€â”€ CONNECTOR_CLASS_MAP (backend/onyx/connectors/factory.py)
â”œâ”€â”€ Document Management
â”‚   â”œâ”€â”€ Google Drive (backend/onyx/connectors/google_drive)
â”‚   â”œâ”€â”€ SharePoint (backend/onyx/connectors/sharepoint)
â”‚   â”œâ”€â”€ Confluence (backend/onyx/connectors/confluence)
â”‚   â”œâ”€â”€ Notion (backend/onyx/connectors/notion)
â”‚   â”œâ”€â”€ Guru (backend/onyx/connectors/guru)
â”‚   â”œâ”€â”€ Slab (backend/onyx/connectors/slab)
â”‚   â””â”€â”€ Bookstack (backend/onyx/connectors/bookstack)
â”œâ”€â”€ Cloud Storage
â”‚   â”œâ”€â”€ Google Cloud Storage (backend/onyx/connectors/gcs)
â”‚   â”œâ”€â”€ S3 (backend/onyx/connectors/s3)
â”‚   â””â”€â”€ R2 (backend/onyx/connectors/r2)
â”œâ”€â”€ Communication
â”‚   â”œâ”€â”€ Slack (backend/onyx/connectors/slack)
â”‚   â”œâ”€â”€ Gmail (backend/onyx/connectors/gmail)
â”‚   â”œâ”€â”€ Outlook (backend/onyx/connectors/outlook)
â”‚   â””â”€â”€ Discord (backend/onyx/connectors/discord)
â”œâ”€â”€ Code Repositories
â”‚   â”œâ”€â”€ GitHub (backend/onyx/connectors/github)
â”‚   â”œâ”€â”€ GitLab (backend/onyx/connectors/gitlab)
â”‚   â””â”€â”€ Bitbucket (backend/onyx/connectors/bitbucket)
â”œâ”€â”€ Ticketing & Project Management
â”‚   â”œâ”€â”€ Jira (backend/onyx/connectors/jira)
â”‚   â”œâ”€â”€ Linear (backend/onyx/connectors/linear)
â”‚   â””â”€â”€ Asana (backend/onyx/connectors/asana)
â”œâ”€â”€ CRM & Sales
â”‚   â”œâ”€â”€ HubSpot (backend/onyx/connectors/hubspot)
â”‚   â”œâ”€â”€ Salesforce (backend/onyx/connectors/salesforce)
â”‚   â””â”€â”€ Zendesk (backend/onyx/connectors/zendesk)
â””â”€â”€ DLT Integration [NEW] â­
    â”œâ”€â”€ DltGenericConnector (backend/onyx/connectors/dlt_generic/connector.py)
    â”œâ”€â”€ Google Ads (Marketing data via dlthub)
    â”œâ”€â”€ Facebook Ads (Marketing data via dlthub)
    â””â”€â”€ LinkedIn Ads (Marketing data via dlthub)

ğŸ“„ DOCUMENT PROCESSING
â”œâ”€â”€ Indexing Pipeline
â”‚   â”œâ”€â”€ Document Ingestion
â”‚   â”‚   â”œâ”€â”€ ConnectorRunner (backend/onyx/background/connector_runner.py)
â”‚   â”‚   â””â”€â”€ BatchIndexingRunner (backend/onyx/indexing/batch_indexing.py)
â”‚   â”œâ”€â”€ Chunking
â”‚   â”‚   â”œâ”€â”€ Chunker (backend/onyx/chunking/chunk.py)
â”‚   â”‚   â”œâ”€â”€ chunk_document (backend/onyx/chunking/chunk.py)
â”‚   â”‚   â””â”€â”€ Strategies: By paragraph / sentence / character with overlap
â”‚   â”œâ”€â”€ Embedding
â”‚   â”‚   â”œâ”€â”€ DefaultIndexingEmbedder (backend/onyx/indexing/embedder.py)
â”‚   â”‚   â”œâ”€â”€ embed_chunks (backend/onyx/indexing/embedder.py)
â”‚   â”‚   â””â”€â”€ Models: text-embedding-3-small, voyage-context-3, custom
â”‚   â””â”€â”€ Content Processing
â”‚       â”œâ”€â”€ Text Extraction (extract_pdf_text, extract_docx_text)
â”‚       â”œâ”€â”€ Image Processing (extract_image_content)
â”‚       â””â”€â”€ OCR integration
â”œâ”€â”€ Metadata
â”‚   â”œâ”€â”€ Extraction (extract_metadata, parse_metadata)
â”‚   â””â”€â”€ Enrichment (add_context, semantic_identifier)
â””â”€â”€ File Storage
    â”œâ”€â”€ get_default_file_store (backend/onyx/file_store/file_store.py)
    â””â”€â”€ Implementations: S3/MinIO, Local, GCS, Azure Blob

ğŸ” VECTOR SEARCH (Vespa)
â”œâ”€â”€ Document Index
â”‚   â”œâ”€â”€ VespaIndex (backend/onyx/document_index/vespa/index.py)
â”‚   â”‚   â”œâ”€â”€ index_chunks
â”‚   â”‚   â”œâ”€â”€ delete_documents
â”‚   â”‚   â””â”€â”€ get_document
â”‚   â””â”€â”€ Schema Management
â”‚       â”œâ”€â”€ DocumentConfig
â”‚       â””â”€â”€ ChunkSchema
â”œâ”€â”€ Search & Retrieval
â”‚   â”œâ”€â”€ Query Processing (build_vespa_query, add_filters, add_boosting)
â”‚   â”œâ”€â”€ Search Types
â”‚   â”‚   â”œâ”€â”€ Keyword Search (BM25 ranking)
â”‚   â”‚   â”œâ”€â”€ Semantic Search (Vector similarity)
â”‚   â”‚   â””â”€â”€ Hybrid Search (RRF fusion)
â”‚   â”œâ”€â”€ Filtering
â”‚   â”‚   â”œâ”€â”€ ACL filtering (Access control)
â”‚   â”‚   â”œâ”€â”€ Time decay
â”‚   â”‚   â””â”€â”€ Source filtering
â”‚   â””â”€â”€ Ranking
â”‚       â”œâ”€â”€ Primary ranking
â”‚       â””â”€â”€ Cross-encoder reranking
â””â”€â”€ Knowledge Graph
    â”œâ”€â”€ extract_entities (backend/onyx/knowledge_graph/extraction.py)
    â”œâ”€â”€ build_relationships (backend/onyx/knowledge_graph/graph.py)
    â””â”€â”€ traverse_graph

ğŸ’¬ CHAT & LLM
â”œâ”€â”€ Chat Pipeline
â”‚   â”œâ”€â”€ Main Entry
â”‚   â”‚   â”œâ”€â”€ process_message (backend/onyx/chat/process_message.py)
â”‚   â”‚   â””â”€â”€ StreamingChatHandler (backend/onyx/chat/stream.py)
â”‚   â””â”€â”€ Components
â”‚       â”œâ”€â”€ Prompt Builder (build_system_prompt, build_user_prompt)
â”‚       â”œâ”€â”€ Stream Processing (stream_chat_response, citation extraction)
â”‚       â””â”€â”€ User Files (attach_files, process_uploads)
â”œâ”€â”€ LLM Integration
â”‚   â”œâ”€â”€ Providers
â”‚   â”‚   â”œâ”€â”€ OpenAI (gpt-4, gpt-3.5-turbo)
â”‚   â”‚   â”œâ”€â”€ Anthropic (claude-3-opus, claude-3-sonnet)
â”‚   â”‚   â”œâ”€â”€ Google (gemini-pro)
â”‚   â”‚   â”œâ”€â”€ Cohere (command-r+)
â”‚   â”‚   â”œâ”€â”€ Azure (Azure OpenAI)
â”‚   â”‚   â””â”€â”€ LiteLLM (Universal gateway)
â”‚   â”œâ”€â”€ Interfaces (LLM base, StreamingLLM, StandardLLM)
â”‚   â””â”€â”€ Token Management
â”‚       â”œâ”€â”€ count_tokens
â”‚       â”œâ”€â”€ truncate_context
â”‚       â””â”€â”€ Rate limiting [EE] (check_token_limit, TokenRateLimit__UserGroup)
â”œâ”€â”€ Context Assembly
â”‚   â”œâ”€â”€ Search Integration (retrieve_documents, rank_by_relevance)
â”‚   â”œâ”€â”€ Context Window (fit_to_context, prioritize_chunks)
â”‚   â””â”€â”€ Citation Handling (extract_citations, map_to_sources)
â”œâ”€â”€ Tools Framework
â”‚   â”œâ”€â”€ BaseTool (backend/onyx/tools/interface.py)
â”‚   â”œâ”€â”€ Search Tool
â”‚   â”œâ”€â”€ Image Tool
â”‚   â”œâ”€â”€ Web Search
â”‚   â””â”€â”€ MCP Tools (Model Context Protocol integration)
â””â”€â”€ Personas/Assistants
    â”œâ”€â”€ Persona model (backend/onyx/db/models.py)
    â”œâ”€â”€ create_persona (backend/onyx/db/persona.py)
    â””â”€â”€ Private Personas [EE] (ee/onyx/db/persona.py)

âš™ï¸ BACKGROUND JOBS (Celery)
â”œâ”€â”€ Worker Architecture
â”‚   â”œâ”€â”€ LIGHTWEIGHT MODE
â”‚   â”‚   â””â”€â”€ Unified Worker (All tasks, 20 threads)
â”‚   â””â”€â”€ STANDARD MODE
â”‚       â”œâ”€â”€ Primary Worker (Coordination, 4 threads)
â”‚       â”œâ”€â”€ Docfetching Worker (Fetch from connectors)
â”‚       â”œâ”€â”€ Docprocessing Worker (Index pipeline)
â”‚       â”œâ”€â”€ Light Worker (Fast operations)
â”‚       â”œâ”€â”€ Heavy Worker (Resource-intensive, 4 threads)
â”‚       â”œâ”€â”€ KG Processing Worker (Knowledge graph)
â”‚       â”œâ”€â”€ Monitoring Worker (Health checks, single thread)
â”‚       â””â”€â”€ Beat Scheduler (Periodic tasks, DynamicTenantScheduler)
â”œâ”€â”€ Task Categories
â”‚   â”œâ”€â”€ Indexing (run_connector_index, sync_vespa, prune_documents)
â”‚   â”œâ”€â”€ Connector Management (delete_connector, validate_connector)
â”‚   â”œâ”€â”€ Permission Syncing [EE] (sync_doc_permissions, sync_external_groups)
â”‚   â”œâ”€â”€ Monitoring (check_celery_queues, check_process_memory, collect_metrics)
â”‚   â””â”€â”€ Cleanup (cleanup_old_data, sync_user_files)
â””â”€â”€ Multi-Tenancy
    â”œâ”€â”€ DynamicTenantScheduler (Per-tenant task scheduling)
    â””â”€â”€ Redis namespacing (Tenant isolation)

ğŸ—„ï¸ DATABASE (PostgreSQL)
â”œâ”€â”€ Core Models
â”‚   â”œâ”€â”€ User (email, password, role, is_active)
â”‚   â”œâ”€â”€ Connector (source, config, status)
â”‚   â”œâ”€â”€ Credential (credential_json encrypted, source, user_id)
â”‚   â”œâ”€â”€ ConnectorCredentialPair (access_type, auto_sync_options)
â”‚   â”œâ”€â”€ Document (external_id, metadata)
â”‚   â”œâ”€â”€ ChatSession / ChatMessage / ChatMessageFeedback
â”‚   â””â”€â”€ Persona / Prompt
â”œâ”€â”€ EE Models [EE]
â”‚   â”œâ”€â”€ UserGroup
â”‚   â”œâ”€â”€ User__UserGroup
â”‚   â”œâ”€â”€ ExternalAccess / DocExternalAccess
â”‚   â”œâ”€â”€ StandardAnswer / StandardAnswerCategory
â”‚   â”œâ”€â”€ TokenRateLimit__UserGroup
â”‚   â””â”€â”€ UsageReportMetadata / ChatSessionSnapshot
â”œâ”€â”€ Operations
â”‚   â”œâ”€â”€ User CRUD (backend/onyx/db/user.py)
â”‚   â”œâ”€â”€ Connector CRUD (backend/onyx/db/connector.py)
â”‚   â”œâ”€â”€ Document CRUD (backend/onyx/db/document.py)
â”‚   â””â”€â”€ Chat CRUD (backend/onyx/db/chat.py)
â””â”€â”€ Migrations
    â”œâ”€â”€ Alembic (100+ migrations)
    â””â”€â”€ Multi-tenant (schema_private for tenant isolation)

ğŸŒ API SERVER (FastAPI)
â”œâ”€â”€ Authentication Endpoints
â”‚   â”œâ”€â”€ /auth/login
â”‚   â”œâ”€â”€ /auth/register
â”‚   â””â”€â”€ /auth/verify
â”œâ”€â”€ Query & Chat Endpoints
â”‚   â”œâ”€â”€ /query (Search)
â”‚   â”œâ”€â”€ /chat/send-message
â”‚   â””â”€â”€ /chat/stream
â”œâ”€â”€ Document Management Endpoints
â”‚   â”œâ”€â”€ /manage/admin/connector (CRUD connectors)
â”‚   â”œâ”€â”€ /manage/admin/credential (CRUD credentials)
â”‚   â”œâ”€â”€ /connector/oauth/authorize (OAuth flow)
â”‚   â””â”€â”€ /connector/oauth/callback
â”œâ”€â”€ Admin Endpoints
â”‚   â”œâ”€â”€ /manage/admin/user
â”‚   â”œâ”€â”€ /manage/admin/user-group [EE]
â”‚   â””â”€â”€ /manage/admin/standard-answer [EE]
â”œâ”€â”€ Analytics Endpoints [EE]
â”‚   â”œâ”€â”€ /admin/analytics/usage
â”‚   â””â”€â”€ /admin/query-history
â””â”€â”€ Middleware
    â”œâ”€â”€ JWT verification
    â”œâ”€â”€ Rate limiting
    â”œâ”€â”€ Tenant routing [EE]
    â””â”€â”€ Logging (Latency tracking, Error logging)

ğŸ“Š EE FEATURES (Enterprise Edition)
â”œâ”€â”€ Permission System
â”‚   â”œâ”€â”€ User Groups
â”‚   â”‚   â”œâ”€â”€ Group Management (create_user_group, add_users_to_group)
â”‚   â”‚   â”œâ”€â”€ Curator Roles (Group-level permissions)
â”‚   â”‚   â””â”€â”€ Integration (43 files use fetch_versioned_implementation)
â”‚   â”œâ”€â”€ External Permissions
â”‚   â”‚   â”œâ”€â”€ Document Sync (Confluence, GDrive, Jira, SharePoint, Salesforce, Slack)
â”‚   â”‚   â”œâ”€â”€ Group Sync (Google Workspace, Azure AD, External IDP)
â”‚   â”‚   â””â”€â”€ Access Mapping (External ID to Onyx user mapping)
â”‚   â””â”€â”€ Access Control
â”‚       â”œâ”€â”€ ACL System (prefix_user_email, prefix_user_group, prefix_external_group)
â”‚       â”œâ”€â”€ Search result filtering
â”‚       â””â”€â”€ Salesforce censoring (Fine-grained content filtering)
â”œâ”€â”€ Analytics & Reporting â­
â”‚   â”œâ”€â”€ Query History (ChatSessionSnapshot, Feedback tracking)
â”‚   â”œâ”€â”€ Usage Analytics (Per-persona stats, Token usage)
â”‚   â”œâ”€â”€ Reporting (CSV export, Usage reports, Audit logs)
â”‚   â””â”€â”€ Dashboards (Admin analytics, Usage charts, Feedback visualization)
â”œâ”€â”€ Knowledge Management â­
â”‚   â”œâ”€â”€ Standard Answers (FAQ automation)
â”‚   â”œâ”€â”€ Matching (Keyword/regex with match_any_keywords flag)
â”‚   â”œâ”€â”€ Slack Auto-response
â”‚   â””â”€â”€ Category Organization
â”œâ”€â”€ Resource Management
â”‚   â”œâ”€â”€ Token Rate Limiting (Per-group quotas via TokenRateLimit__UserGroup)
â”‚   â”œâ”€â”€ Usage Tracking (Token counting, Usage aggregation)
â”‚   â””â”€â”€ Limit Enforcement (Query pipeline checks, Alerts)
â”œâ”€â”€ Multi-Tenancy
â”‚   â”œâ”€â”€ Tenant Isolation (Schema separation, Per-tenant DB)
â”‚   â”œâ”€â”€ Tenant Routing (get_tenant_id_for_email, Middleware routing)
â”‚   â””â”€â”€ Multi-tenant Scheduler (DynamicTenantScheduler)
â””â”€â”€ Advanced Features
    â”œâ”€â”€ Feature Flags (PostHog integration, A/B testing)
    â”œâ”€â”€ Billing (Subscription management, Payment integration)
    â””â”€â”€ White-Labeling (Custom branding, Logo upload, Theme customization)

ğŸ¨ FRONTEND (Next.js 15)
â”œâ”€â”€ Public Pages
â”‚   â”œâ”€â”€ /login (web/src/app/login)
â”‚   â”œâ”€â”€ /search (web/src/app/search)
â”‚   â””â”€â”€ /chat (web/src/app/chat)
â”œâ”€â”€ Admin Pages
â”‚   â”œâ”€â”€ /admin/connectors (Connector setup, OAuth flows)
â”‚   â”œâ”€â”€ /admin/indexing (Index status)
â”‚   â””â”€â”€ /admin/users (User management)
â”œâ”€â”€ EE Admin Pages [EE]
â”‚   â”œâ”€â”€ /ee/admin/groups (Group management)
â”‚   â”œâ”€â”€ /ee/admin/performance (Analytics dashboards, Query history, Usage reports)
â”‚   â”œâ”€â”€ /ee/admin/standard-answer (Answer management)
â”‚   â”œâ”€â”€ /ee/admin/billing (Subscription)
â”‚   â””â”€â”€ /ee/admin/whitelabeling (Branding config)
â”œâ”€â”€ Components
â”‚   â”œâ”€â”€ Chat Interface (ChatWindow, MessageList, InputBox, Streaming display)
â”‚   â”œâ”€â”€ Search UI (SearchBar, ResultsList, Filters, Citations)
â”‚   â”œâ”€â”€ Connector Setup (ConnectorForm, OAuth flows, Credential forms)
â”‚   â””â”€â”€ Admin Components (UserTable, GroupEditor [EE], AnalyticsCharts [EE])
â””â”€â”€ State Management
    â”œâ”€â”€ SWR (Data fetching and caching)
    â”œâ”€â”€ React hooks (useState, useEffect, Custom hooks)
    â””â”€â”€ User context (Global user state)

ğŸ› ï¸ INFRASTRUCTURE
â”œâ”€â”€ Configuration
â”‚   â”œâ”€â”€ App Config (backend/onyx/configs/app_configs.py)
â”‚   â”œâ”€â”€ LLM Config (backend/onyx/configs/model_configs.py)
â”‚   â””â”€â”€ Embedding Config (backend/onyx/configs/model_configs.py)
â”œâ”€â”€ Redis
â”‚   â”œâ”€â”€ Celery broker (Task queue messaging)
â”‚   â”œâ”€â”€ OAuth state (Temporary state storage)
â”‚   â”œâ”€â”€ Caching (General-purpose)
â”‚   â””â”€â”€ Per-tenant namespacing (Multi-tenancy isolation)
â”œâ”€â”€ Monitoring
â”‚   â”œâ”€â”€ Logging (setup_logger, Structured logging)
â”‚   â”œâ”€â”€ Tracing (Request tracing, Span tracking)
â”‚   â”œâ”€â”€ Telemetry (Usage metrics, Error tracking)
â”‚   â””â”€â”€ Health Checks (/health endpoint, Service status)
â”œâ”€â”€ Utilities
â”‚   â”œâ”€â”€ NLP (Tokenization, Text processing)
â”‚   â”œâ”€â”€ Encryption (encrypt_string, decrypt_string)
â”‚   â””â”€â”€ Versioning (OnyxVersion, EE detection, fetch_versioned_implementation)
â”œâ”€â”€ Deployment
â”‚   â”œâ”€â”€ Docker (Backend + Web + Model server Dockerfiles)
â”‚   â”œâ”€â”€ Docker Compose (10+ compose files, 9-10 services)
â”‚   â””â”€â”€ Kubernetes (Helm charts, Multi-replica)
â””â”€â”€ Testing
    â”œâ”€â”€ Unit Tests (Component isolation)
    â”œâ”€â”€ Integration Tests (Full stack tests, Connector tests)
    â”œâ”€â”€ Daily Tests (Connector validation, Permission tests)
    â””â”€â”€ Regression Tests (Search quality, Answer quality)

================================================
EXTRACTION GUIDANCE FOR KNOWSEE
================================================

âœ… EXTRACT (HIGH VALUE - ~2,000 LOC)
- Connector framework (300 LOC)
- OAuth flow (150 LOC)
- Document models (150 LOC)
- User groups [EE] (500 LOC) â­
- Standard answers [EE] (300 LOC) â­
- Query history [EE] (200 LOC) â­
- Access control basics (400 LOC)

âŒ REPLACE WITH SIMPLER (Saves 95,000 LOC)
- Vespa â†’ Pinecone (100 LOC wrapper)
- Custom chunking â†’ LangChain
- 9 Celery workers â†’ 1 background worker
- Custom embedding â†’ OpenAI API
- FastAPI-Users â†’ NextAuth.js

â›” SKIP ENTIRELY (Saves 35,000 LOC)
- Multi-tenancy complexity
- External permission syncing
- Federated search
- SlackBot integration
- 20+ other enterprise features

RESULT: 100,000 LOC â†’ 3,000 LOC (97% reduction)

================================================
KEY METRICS
================================================

Total Backend Files: ~1,000+ Python files
Lines of Code: ~100,000 LOC (backend)
Database Tables: 50+ models (30+ core, 20+ EE)
API Endpoints: 100+ routes
Connectors: 50+ implementations
Celery Workers: 9 specialized (or 1 unified)
Background Tasks: 50+ task types
Docker Services: 9-10 containers
Frontend Pages: 50+ routes
Tests: 1,000+ test files

================================================

â­ = HIGH VALUE FOR KNOWSEE (Marketing agency platform)
[EE] = Enterprise Edition features

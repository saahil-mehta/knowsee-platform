services:
  sagent-backend:
    build:
      context: ..
      dockerfile: Dockerfile
    container_name: sagent-backend
    environment:
      - ALLOW_ORIGINS=http://localhost:3000
      - GOOGLE_APPLICATION_CREDENTIALS=/root/.config/gcloud/application_default_credentials.json
      - GOOGLE_CLOUD_PROJECT=${GOOGLE_CLOUD_PROJECT}
      - GOOGLE_CLOUD_LOCATION=${GOOGLE_CLOUD_LOCATION:-europe-west2}
    ports:
      - "8000:8080"
    volumes:
      - ${HOME}/.config/gcloud:/root/.config/gcloud:ro
    networks:
      - sagent-stack

  sagent-frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile.local
    container_name: sagent-frontend
    working_dir: /app
    environment:
      - NEXT_PUBLIC_AGUI_URL=http://sagent-backend:8080/api/agui
      - NEXT_PUBLIC_COPILOT_AGENT=sagent_copilot
      - AGENT_RUNTIME_URL=http://sagent-backend:8080/api/agui
    ports:
      - "3000:3000"
    depends_on:
      - sagent-backend
    networks:
      - sagent-stack

networks:
  sagent-stack:
    driver: bridge
